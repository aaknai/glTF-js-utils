!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.GLTFUtils=t():e.GLTFUtils=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n=function(){function e(){this.copyright="",this.defaultScene=0,this.generator="glTF-js-utils",this._scenes=[]}return e.prototype.setDefaultScene=function(e){if("number"==typeof e)this.defaultScene=e;else{var t=this._scenes.indexOf(e);if(-1===t)throw new Error("Scene passed to setDefaultScene was not found.");this.defaultScene=t}},e.prototype.addScene=function(e){if(this._scenes.indexOf(e)>=0)throw new Error("Scene passed to addScene was added prior.");this._scenes.push(e)},e.prototype.removeScene=function(e){var t=this._scenes.indexOf(e);t>=0&&this._scenes.splice(t,1)},e.prototype.forEachScene=function(e){this._scenes.forEach(e)},e}(),o=function(){function e(){this.name="",this._nodes=[]}return e.prototype.addNode=function(e){if(this._nodes.indexOf(e)>=0)throw new Error("Node passed to addNode was added prior.");this._nodes.push(e)},e.prototype.forEachNode=function(e){this._nodes.forEach(e)},e}(),s=function(){function e(e,t,r){this.x=0,this.y=0,this.z=0,this.x=e,this.y=t,this.z=r}return e.prototype.toArray=function(){return[this.x,this.y,this.z]},e}(),a=function(){function e(e,t,r,n){this.x=e,this.y=t,this.z=r,this.w=n}return e.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},e}();function i(e){return e*Math.PI/180}var u,c,f,h,p,l=function(){function e(){this.name="",this._nodes=[]}return e.prototype.addNode=function(e){if(this._nodes.indexOf(e)>=0)throw new Error("Node passed to addNode was added prior.");this._nodes.push(e)},e.prototype.forEachNode=function(e){this._nodes.forEach(e)},e.prototype.setTranslation=function(e,t,r){this._translation=new s(e,t,r)},e.prototype.getTranslation=function(){return this._translation||new s(0,0,0)},e.prototype.setRotationDegrees=function(e,t,r){this.setRotationRadians(i(e),i(t),i(r))},e.prototype.setRotationRadians=function(e,t,r){this._rotation=function(e,t,r){var n=Math.cos(.5*r),o=Math.sin(.5*r),s=Math.cos(.5*e),i=Math.sin(.5*e),u=Math.cos(.5*t),c=Math.sin(.5*t);return new a(n*i*u-o*s*c,n*s*c+o*i*u,o*s*u-n*i*c,n*s*u+o*i*c)}(e,t,r)},e.prototype.setRotationQuaternion=function(e,t,r,n){this._rotation=new a(e,t,r,n)},e.prototype.getRotationQuaternion=function(){return this._rotation||new a(0,0,0,1)},e.prototype.setScale=function(e,t,r){this._scale=new s(e,t,r)},e.prototype.getScale=function(){return this._scale||new s(1,1,1)},e}(),d=function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT"}(u||(u={})),function(e){e.SCALAR="SCALAR",e.VEC2="VEC2",e.VEC3="VEC3",e.VEC4="VEC4",e.MAT2="MAT2",e.MAT3="MAT3",e.MAT4="MAT4"}(c||(c={})),function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(f||(f={})),function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.REPEAT=10497]="REPEAT"}(h||(h={})),function(e){e.OPAQUE="OPAQUE",e.MASK="MASK",e.BLEND="BLEND"}(p||(p={}));var y,m=function(){return function(){this.r=1,this.g=1,this.b=1}}(),_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.a=1,t}return d(t,e),t}(m);!function(e){e[e.NoColors=0]="NoColors",e[e.FaceColors=1]="FaceColors",e[e.VertexColors=2]="VertexColors"}(y||(y={}));var v=function(){function e(){this.material=[],this.mode=f.TRIANGLES,this._vertices=[],this._faceColors=[],this._materialIndices=[]}return e.prototype.addFace=function(e,t,r,n,o){this._vertices.push(e),this._vertices.push(t),this._vertices.push(r),this._faceColors.push(n),this._materialIndices.push(o)},e.prototype.forEachFace=function(e){for(var t=0;t<this._vertices.length/3;t++)e(this._vertices[3*t],this._vertices[3*t+1],this._vertices[3*t+2],this._faceColors[t],this._materialIndices[t])},e}(),g=function(){return function(){this.name="",this.alphaCutoff=.5,this.alphaMode=p.OPAQUE,this.doubleSided=!1,this.vertexColorMode=y.NoColors,this.pbrMetallicRoughness={metallicFactor:1,roughnessFactor:1}}}(),T=function(){return function(){this.wrapS=h.CLAMP_TO_EDGE,this.wrapT=h.CLAMP_TO_EDGE}}(),E=function(){return function(){this.x=0,this.y=0,this.z=0,this.u=0,this.v=0,this.normalX=0,this.normalY=0,this.normalZ=0}}();function w(e){var t=new n,r=new o;return r.name=e.name,t.addScene(r),r.addNode(function e(t){var r=new l;r.name=t.name;if(function(e){return"Mesh"===e.type}(t))r.mesh=function(e){var t=new v,r=e.geometry;if(!function(e){return"Geometry"===e.type}(r))throw new Error("BufferGeometry (or other type) not supported.");for(var n=0;n<r.faces.length;n++){var o=r.faces[n],s=new m;s.r=o.color.r,s.g=o.color.g,s.b=o.color.b,t.addFace(x(r,n,o.a,0),x(r,n,o.b,1),x(r,n,o.c,2),s,o.materialIndex)}t.material=function(e){var t=[];Array.isArray(e)||(e=[e]);for(var r=0,n=e;r<n.length;r++){var o=n[r];t.push(b(o))}return t}(e.material);return t}(t);else{r.setTranslation(t.position.x,t.position.y,t.position.z),r.setRotationRadians(t.rotation.x,t.rotation.y,t.rotation.z),r.setScale(t.scale.x,t.scale.y,t.scale.z);for(var n=0,o=t.children;n<o.length;n++){var s=o[n];r.addNode(e(s))}}return r}(e)),t}function b(e){var t=new g;if(t.doubleSided=2===e.side,!function(e){return"MeshBasicMaterial"===e.type}(e))throw new Error(e.type+" is currently not supported.");if(t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=0,e.transparent&&(t.alphaMode=p.MASK,t.alphaCutoff=e.alphaTest),t.vertexColorMode=e.vertexColors,e.color&&0===e.vertexColors&&(t.pbrMetallicRoughness.baseColorFactor=[e.color.r,e.color.g,e.color.b,1]),e.map){var r=new T;r.image=e.map.image,r.wrapS=S(e.map.wrapS),r.wrapT=S(e.map.wrapT),t.pbrMetallicRoughness.baseColorTexture=r}return t}function x(e,t,r,n){var o=new E,s=e.vertices[r];o.x=s.x,o.y=s.y,o.z=s.z,e.faceVertexUvs[0]&&e.faceVertexUvs[0][t]&&e.faceVertexUvs[0][t][n]&&(o.u=e.faceVertexUvs[0][t][n].x,o.v=e.faceVertexUvs[0][t][n].y);var a=e.faces[t];return a.vertexNormals[n]&&(o.normalX=a.vertexNormals[n].x,o.normalY=a.vertexNormals[n].y,o.normalZ=a.vertexNormals[n].z),a.vertexColors[n]&&(o.color=new m,o.color.r=a.vertexColors[n].r,o.color.g=a.vertexColors[n].g,o.color.b=a.vertexColors[n].b),o}function S(e){switch(e){case 1e3:return h.REPEAT;case 1002:return h.MIRRORED_REPEAT;case 1001:default:return h.CLAMP_TO_EDGE}}var A,O,N=function(){function e(){this._bufferViews=[]}return e.prototype.addBufferView=function(e,t){var r=new C(this,e,t);return this._bufferViews.push(r),r},e.prototype.getByteOffset=function(e){for(var t=0,r=0,n=this._bufferViews;r<n.length;r++){var o=n[r];if(o===e)return t;t+=o.getSize()}throw"Given bufferView was not present in this buffer"},e.prototype.getArrayBuffer=function(){for(var e=this._getTotalSize(),t=new ArrayBuffer(e),r=0,n=0,o=this._bufferViews;n<o.length;n++){var s=o[n];s.write(t,r),r+=s.getSize()}return t},e.prototype._getTotalSize=function(){for(var e=0,t=0,r=this._bufferViews;t<r.length;t++){e+=r[t].getSize()}return e},e}(),C=function(){function e(e,t,r){this._data=[],this._accessorIndex=-1,this._buffer=e,this._componentType=t,this._dataType=r}return e.prototype.push=function(e){this._data.push(e)},e.prototype.getSize=function(){return this._data.length*this._sizeOfComponentType()},e.prototype.getByteOffset=function(){return this._buffer.getByteOffset(this)},e.prototype.write=function(e,t){for(var r=new DataView(e,t),n=this._sizeOfComponentType(),o=0;o<this._data.length;o++){var s=this._data[o];this._writeValue(r,o*n,s)}},e.prototype.startAccessor=function(){if(this._accessorIndex>=0)throw"Accessor was started without ending the previous one";this._accessorIndex=this._data.length},e.prototype.endAccessor=function(){if(this._accessorIndex<0)throw"An accessor was not started, but was attempted to be ended";var e=this._getElementSize(),t=this._numComponentsForDataType(),r=(this._data.length-this._accessorIndex)/t;if(r%1)throw"An accessor was ended with missing component values";var n={byteOffset:e*(this._accessorIndex/t),componentType:this._componentType,count:r,type:this._dataType};return this._accessorIndex=-1,n},e.prototype._getElementSize=function(){return this._sizeOfComponentType()*this._numComponentsForDataType()},e.prototype._sizeOfComponentType=function(){switch(this._componentType){case u.BYTE:case u.UNSIGNED_BYTE:return 1;case u.SHORT:case u.UNSIGNED_SHORT:return 2;case u.UNSIGNED_INT:case u.FLOAT:return 4}throw"Unrecognized component type "+this._componentType},e.prototype._numComponentsForDataType=function(){switch(this._dataType){case c.SCALAR:return 1;case c.VEC2:return 2;case c.VEC3:return 3;case c.VEC4:case c.MAT2:return 4;case c.MAT3:return 9;case c.MAT4:return 16}throw"Unsupported data type"},e.prototype._writeValue=function(e,t,r){switch(this._componentType){case u.BYTE:e.setInt8(t,r);break;case u.UNSIGNED_BYTE:e.setUint8(t,r);break;case u.SHORT:e.setInt16(t,r,!0);break;case u.UNSIGNED_SHORT:e.setUint16(t,r,!0);break;case u.UNSIGNED_INT:e.setUint32(t,r,!0);break;case u.FLOAT:e.setFloat32(t,r,!0);break;default:throw"Unsupported data type"}},e}();r.d(t,"BufferOutputType",function(){return A}),r.d(t,"ImageOutputType",function(){return O}),r.d(t,"exportGLTF",function(){return M}),r.d(t,"exportGLTFZip",function(){return I}),r.d(t,"GLTFAsset",function(){return n}),r.d(t,"Scene",function(){return o}),r.d(t,"Node",function(){return l}),r.d(t,"Mesh",function(){return v}),r.d(t,"Material",function(){return g}),r.d(t,"Texture",function(){return T}),r.d(t,"Vertex",function(){return E}),r.d(t,"XYZPair",function(){return s}),r.d(t,"Quaternion",function(){return a}),r.d(t,"glTFAssetFromTHREE",function(){return w}),r.d(t,"AlphaMode",function(){return p}),r.d(t,"ComponentType",function(){return u}),r.d(t,"DataType",function(){return c}),r.d(t,"MeshMode",function(){return f}),r.d(t,"RGBColor",function(){return m}),r.d(t,"RGBAColor",function(){return _}),r.d(t,"VertexColorMode",function(){return y}),r.d(t,"WrappingMode",function(){return h}),function(e){e[e.External=0]="External",e[e.DataURI=1]="DataURI"}(A||(A={})),function(e){e[e.External=0]="External",e[e.DataURI=1]="DataURI"}(O||(O={}));var R="model.gltf";function M(e,t){t=t||{};var r={asset:{version:"2.0",copyright:e.copyright,generator:e.generator}};!function(e,t){e.scene=t.defaultScene,t.forEachScene(function(t){!function(e,t){e.scenes||(e.scenes=[]);var r={};t.name&&(r.name=t.name);t.forEachNode(function(t){r.nodes||(r.nodes=[]);var n=function e(t,r){t.nodes||(t.nodes=[]);var n={};r.name&&(n.name=r.name);var o=r.getTranslation();0===o.x&&0===o.y&&0===o.z||(n.translation=o.toArray());var s=r.getRotationQuaternion();0===s.x&&0===s.y&&0===s.z&&1===s.w||(n.rotation=s.toArray());var a=r.getScale();1===a.x&&1===a.y&&1===a.z||(n.scale=a.toArray());var i=t.nodes.length;t.nodes.push(n);r.mesh?n.mesh=function(e,t){e.meshes||(e.meshes=[]);if(t.mode!==f.TRIANGLES)throw"MeshMode other than TRIANGLES not currently supported";!function(e,t){for(var r=[],n=0,o=t;n<o.length;n++){var s=o[n];r.push(G(e,s))}}(e,t.material);var r={primitives:[]},n=e.meshes.length;e.meshes.push(r);var o,s=new N,a=function(e,t){e.buffers||(e.buffers=[]);var r=e.buffers.length;return e.buffers.push({byteLength:-1,extras:t}),r}(e,s),i=s.addBufferView(u.FLOAT,c.VEC3),h=V(e,i,a),p=s.addBufferView(u.FLOAT,c.VEC3),l=V(e,p,a),d=s.addBufferView(u.FLOAT,c.VEC2),_=V(e,d,a),v=s.addBufferView(u.UNSIGNED_BYTE,c.VEC3),g=V(e,v,a),T=null;if(t.forEachFace(function(n,s,a,u,c){var f=t.material[c];if(o=t.material[T],T!==c){if(null!==T){var E=i.endAccessor(),w=p.endAccessor(),b=d.endAccessor(),x={attributes:{POSITION:U(e,h,E),NORMAL:U(e,l,w),TEXCOORD_0:U(e,_,b)},material:T,mode:t.mode};if(o.vertexColorMode!==y.NoColors){var S=v.endAccessor();x.attributes.COLOR_0=U(e,g,S)}r.primitives.push(x)}i.startAccessor(),p.startAccessor(),d.startAccessor(),f.vertexColorMode!==y.NoColors&&v.startAccessor(),T=c,o=t.material[T]}switch(i.push(n.x),i.push(n.y),i.push(n.z),i.push(s.x),i.push(s.y),i.push(s.z),i.push(a.x),i.push(a.y),i.push(a.z),p.push(n.normalX),p.push(n.normalY),p.push(n.normalZ),p.push(s.normalX),p.push(s.normalY),p.push(s.normalZ),p.push(a.normalX),p.push(a.normalY),p.push(a.normalZ),d.push(n.u),d.push(n.v),d.push(s.u),d.push(s.v),d.push(a.u),d.push(a.v),f.vertexColorMode){case y.FaceColors:for(var A=0;A<3;A++)L(v,u||new m);break;case y.VertexColors:L(v,n.color||new m),L(v,s.color||new m),L(v,a.color||new m)}}),null!==T){var E=i.endAccessor(),w=p.endAccessor(),b=d.endAccessor(),x={attributes:{POSITION:U(e,h,E),NORMAL:U(e,l,w),TEXCOORD_0:U(e,_,b)},material:T,mode:t.mode};if(o.vertexColorMode!==y.NoColors){var S=v.endAccessor();x.attributes.COLOR_0=U(e,g,S)}r.primitives.push(x)}return function(e,t){var r=e.buffers[t],n=r.extras.getArrayBuffer();r.byteLength=n.byteLength,r.uri=n,delete r.extras}(e,a),D(e,h),D(e,l),D(e,_),D(e,g),n}(t,r.mesh):r.forEachNode(function(r){n.children||(n.children=[]);var o=e(t,r);n.children.push(o)});return i}(e,t);r.nodes.push(n)}),e.scenes.push(r)}(e,t)})}(r,e);var n=1,o=1,s={},a=t.hasOwnProperty("jsonSpacing")?t.jsonSpacing:4,i=JSON.stringify(r,function(e,r){if(r instanceof ArrayBuffer){if(t.bufferOutputType===A.DataURI)return function(e){for(var t=[],r=new Uint8Array(e),n=0;n<r.length;n++)t.push(String.fromCharCode(r[n]));return"data:application/octet-stream;base64,"+btoa(t.join(""))}(r);var a="data"+n+".bin";return n++,s[a]=r,a}if(r instanceof HTMLImageElement||r instanceof HTMLCanvasElement){if(t.imageOutputType===O.DataURI)return P(r);a="img"+o+".png";return o++,s[a]=P(r),s[a]=s[a].substr(s[a].indexOf(",")+1),a}return r},a);return s[R]=i,s}function I(e,t,r){var n=M(e,r),o=new t;for(var s in n)s!==R&&"string"==typeof n[s]?o.file(s,n[s],{base64:!0}):o.file(s,n[s]);return o.generateAsync({type:"blob"})}function L(e,t){e.push(255*t.r|0),e.push(255*t.g|0),e.push(255*t.b|0)}function V(e,t,r){e.bufferViews||(e.bufferViews=[]);var n=e.bufferViews.length;return e.bufferViews.push({buffer:r,byteLength:-1,extras:t}),n}function D(e,t){var r=e.bufferViews[t],n=r.extras;r.byteOffset=n.getByteOffset(),r.byteLength=n.getSize(),delete r.extras}function U(e,t,r){e.accessors||(e.accessors=[]);var n=e.accessors.length;return e.accessors.push({bufferView:t,byteOffset:r.byteOffset,componentType:r.componentType,count:r.count,type:r.type}),n}function G(e,t){e.materials||(e.materials=[]);var r={};if(t.name&&(r.name=t.name),t.alphaMode!==p.OPAQUE&&(r.alphaMode=t.alphaMode),.5!==t.alphaCutoff&&(r.alphaCutoff=t.alphaCutoff),t.doubleSided&&(r.doubleSided=!0),t.pbrMetallicRoughness&&(t.pbrMetallicRoughness.baseColorFactor&&(F(r,"pbrMetallicRoughness",{}),r.pbrMetallicRoughness.baseColorFactor=t.pbrMetallicRoughness.baseColorFactor),t.pbrMetallicRoughness.baseColorTexture)){F(r,"pbrMetallicRoughness",{});var n=function(e,t){e.textures||(e.textures=[]);var r={sampler:function(e,t){e.samplers||(e.samplers=[]);for(var r={wrapS:t.wrapS,wrapT:t.wrapT},n=0;n<e.samplers.length;n++)if(z(r,e.samplers[n]))return n;var o=e.samplers.length;return e.samplers.push(r),o}(e,t),source:function(e,t){e.images||(e.images=[]);var r={};r.uri=t;for(var n=0;n<e.images.length;n++)if(t===e.images[n].uri)return n;var o=e.images.length;return e.images.push(r),o}(e,t.image)},n=e.textures.length;return e.textures.push(r),n}(e,t.pbrMetallicRoughness.baseColorTexture);r.pbrMetallicRoughness.baseColorTexture={index:n}}var o=e.materials.length;return e.materials.push(r),o}function F(e,t,r){e[t]=e[t]||r}function P(e){var t;e instanceof HTMLImageElement?((t=document.createElement("canvas")).width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height)):t=e;return t.toDataURL()}function z(e,t){return JSON.stringify(e)===JSON.stringify(t)}}])});